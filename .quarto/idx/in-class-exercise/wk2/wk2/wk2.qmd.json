{"title":"In-class Exercise 2","markdown":{"yaml":{"title":"In-class Exercise 2","date":"`r Sys.Date()`","format":"html","execute":{"message":false,"warning":false},"editor":"visual"},"headingText":"! code-fold: true","containsRefs":false,"markdown":"\n\n```{r}\n#! code-summary: \"Show the code\"\npacman::p_load(sf, tidyverse, funModeling)\n```\n\n## Aspatial data\n\n```{r}\nwp_nga <- read_csv(\"data/aspatial/WPdx.csv\") %>%\n  filter(`#clean_country_name` == \"Nigeria\")\nwp_nga$Geometry = st_as_sfc(wp_nga$`New Georeferenced Column`)\nwp_nga\nwp_sf <- st_sf(wp_nga, crs=4326)\nwp_sf\nwp_sf <- wp_sf %>%\n  st_transform(crs = 26392)\n```\n\n## Geospatial data\n\n```{r}\ngeoNGA <- st_read(dsn = \"data/geospatial\", \n                  layer = \"geoBoundaries-NGA-ADM2\")%>%\n  st_transform(crs = 26392)\nNGA <- st_read(\"data/geospatial\",\n               layer = \"nga_admbnda_adm2\")%>%\n  st_transform(crs = 26392)\n```\n\n# Data processing\n\n```{r}\nwp_nga$Geometry = st_as_sfc(wp_nga$`New Georeferenced Column`)\nglimpse(wp_nga)\n\nwp_sf <- st_sf(wp_nga, crs=4326)\nwp_sf\n```\n\n# Transformation\n\n```{r}\nwp_sf <- wp_sf %>%\n  st_transform(crs = 26392)\n```\n\n```{r}\nduplicated_LGA <- NGA$ADM2_EN[duplicated(NGA$ADM2_EN)==TRUE]\n\nduplicated_indices <- which(NGA$ADM2_EN %in% duplicated_LGA)\n\nfor (ind in duplicated_indices) {\n  NGA$ADM2_EN[ind] <- paste(NGA$ADM2_EN[ind], NGA$ADM1_EN[ind], sep=\", \")\n}\n```\n\n# Calculate proportion of functional to non functional waterpoints\n\n```{r}\nwp_sf_nga <- wp_sf %>%\n  rename(status_clean = '#status_clean') %>%\n  select(status_clean) %>%\n  mutate(status_clean = replace_na(\n    status_clean, \"unknown\"\n  ))\n```\n\n```{r}\nWP_Functional <- wp_sf_nga %>%\n  filter(status_clean %in%\n           c(\"Functional\",\n             \"Functional but not in use,\n             Functional but needs repair\"))\n```\n\n```{r}\nwp_nonfunctional <- wp_sf_nga %>%\n  filter(status_clean %in%\n           c(\"Abandoned/Decommissioned\",\n             \"Abandoned\",\n             \"Non-Functional due to dry season\",\n             \"Non-Functional\",\n             \"Non functional due to dry season\"))\n```\n\n```{r}\nunique(wp_sf$`#status_clean`)\n\nfunctional <- wp_sf %>% filter(`#status_clean` == \"Functional\") \nWP_Functional <- lengths(st_intersects(geoNGA, functional))\n\nnon_functional <- wp_sf %>% filter(`#status_clean` == \"Non-Functional\")\nWP_Non_Functional <- lengths(st_intersects(geoNGA, non_functional))\n\nWP_Total <- lengths(st_intersects(geoNGA, wp_sf))\n```\n\n# Combine spatial and aspatial data\n\n```{r}\nnga_combined <- tibble(geoNGA, WP_Functional, WP_Non_Functional, WP_Total)\n```\n\n```{r}\nnga_combined <- nga_combined %>%\n  mutate(`WP_Functional_Proportion` = `WP_Functional`/`WP_Total`,\n         `WP_Non_Functional_Proportion` = `WP_Non_Functional`/`WP_Total`)\n```\n\n```{r}\nnga_combined$`WP_Functional_Proportion`[is.na(nga_combined$`WP_Functional_Proportion`)] = 0\n\nnga_combined$`WP_Non_Functional_Proportion`[is.na(nga_combined$`WP_Non_Functional_Proportion`)] = 0\n```\n\n```{r}\nhead(nga_combined, n=5)\n```\n\n# Visualizing the data\n\n```{r}\nggplot(data=nga_combined, \n       aes(x= as.numeric(`WP_Total`)))+\n  geom_histogram(bins=20, \n                 color=\"black\", \n                 fill=\"light blue\") +\n  labs(title = \"Distribution of Total Water Points\",\n       x = \"Number of Water Points\",\n       y = \"Number of LGAs\")\n```\n\n```{r}\nggplot(data=nga_combined, \n       aes(y = `WP_Total`, \n           x= as.numeric(`WP_Functional_Proportion`)))+\n  geom_point(color=\"violet\") +\n  labs(x = \"Proportion Functional\",\n       y = \"Total Water Points\")\n```\n"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"message":false,"engine":"knitr"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../../../styles.css"],"toc":true,"output-file":"wk2.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.2.313","editor":"visual","theme":"cosmo","title":"In-class Exercise 2","date":"`r Sys.Date()`"},"extensions":{"book":{"multiFile":true}}}}}